# Cargo configuration for Zero OS
# This file configures both WASM and x86_64 bare metal targets

# ============================================================================
# WASM Target Configuration
# ============================================================================
[target.wasm32-unknown-unknown]
# For process binaries that need shared memory (atomics-based syscalls):
# - import-memory: Import memory from host instead of defining internally
# - shared-memory: Mark memory as shared (requires atomics)
# - atomics: Enable atomic instructions for SharedArrayBuffer
# - bulk-memory: Required for atomics
# - mutable-globals: Required for shared memory
# - initial-memory/max-memory: Set memory size (2MB initial, 4MB max)
#
# NOTE: This requires nightly Rust and -Z build-std to compile std with atomics
# The atomics/bulk-memory/mutable-globals target features are still unstable,
# which produces warnings. These are expected and harmless.
rustflags = [
    "-C", "target-feature=+atomics,+bulk-memory,+mutable-globals",
    "-C", "link-arg=--import-memory",
    "-C", "link-arg=--shared-memory",
    "-C", "link-arg=--initial-memory=2097152",
    "-C", "link-arg=--max-memory=4194304",
]

# ============================================================================
# x86_64 Bare Metal Target Configuration (QEMU / Phase 2)
# ============================================================================
[target.x86_64-unknown-none]
# Configuration for bare metal kernel
# Use runner for QEMU testing
runner = "qemu-system-x86_64 -device isa-debug-exit,iobase=0xf4,iosize=0x04 -serial stdio -display none -kernel"

[unstable]
# Required for compiling core/alloc for bare metal targets
# This must be used with: cargo build -Z build-std=core,alloc --target x86_64-unknown-none
# The panic_abort is handled via profile settings
build-std-features = ["compiler-builtins-mem"]
